<?php

/**
 * Implements hook_help().
 */
function waggle_email_help($path, $arg) {
  switch ($path) {
    case 'admin/help#waggle_email':
      return '<p>' . t("Waggle email.") . '</p>';
  }
}

/*
 * Implements hook_cron
 */
function waggle_email_cron()
{
  // TODO: eventually check the imap server for incoming messages, but
  // first make sure it _works_ and second make sure hook_cron is the right place
  // for this... sometimes the process is long-running, so it may not be
}

/*
 * Implements hook_menu().
 */
function waggle_email_menu()
{
  $items = array();
  $items['admin/config/waggle_email'] = array(
    'title' => 'Waggle Email',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('waggle_email_admin_form'),
    'access arguments' => array('administer site configuration'), 
    'file' => 'waggle_email.admin.inc',
  );
  $items['admin/config/waggle_email/imap_credentials'] = array(
    'title' => 'IMAP Credentials',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('waggle_email_admin_form'),
    'access arguments' => array('administer site configuration'), 
    'file' => 'waggle_email.admin.inc',
  );

  return $items;
}

function waggle_email_admin_form_validate($form, $form_state)
{
}

function waggle_email_admin_form_submit($form, &$form_state)
{
  $server = $form_state['values']['server'];
  $user = $form_state['values']['user'];
  $pass = $form_state['values']['pass'];
  $secure = $form_state['values']['secure'];
  variable_set('waggle_email_imap_server', $server);
  variable_set('waggle_email_imap_user', $user);
  variable_set('waggle_email_imap_pass', $pass);
  variable_set('waggle_email_imap_secure', $secure);
}

// TODO: this is the big mamma jamma-- connect to imap, get messages,
// create stories
function waggle_email_collect_imap_messages()
{
  $server = variable_get('waggle_email_imap_server');
  $imap_user = variable_get('waggle_email_imap_user');
  $imap_pass = variable_get('waggle_email_imap_pass');
  $use_secure = variable_get('waggle_email_imap_secure', 1);
}

